---
id: 149
title: 'ImageMagick: Remote execution vulnerability (CVE-2016–3714)'
date: 2016-05-06T02:29:23+00:00
author: Prabuddha
layout: post
guid: https://prabuddha.me/?p=149
permalink: /imagemagick-remote-execution-vulnerability-cve-2016-3714/
switch_like_status:
  - "1"
dsq_thread_id:
  - "6211678375"
categories:
  - security
---
Several security vulnerabilities have been recently discovered for certain ImageMagick coders. Specifically, the vulnerabilities include possible remote code execution and the ability to render files on the local system.

Vulnerabilities disclosed on Tuesday affecting ImageMagick, a widely used open source software suite for image manipulation, pertain to a wide variety of users due to the sheer number of projects that rely on the ImageMagick library. Most notably, <a href="https://www.phpbb.com/" target="_blank">phpBB</a>, <a href="https://www.vbulletin.com/" target="_blank">vBulletin</a>, <a href="https://www.mediawiki.org/" target="_blank">MediaWiki</a>, and <a href="https://www.joomla.org/" target="_blank">Joomla</a> use ImageMagick by default, while other software such as <a href="https://wordpress.com/" target="_blank">WordPress</a> and <a href="https://www.drupal.org/" target="_blank">Drupal</a> can utilize the library as a plug-in, or may be enabled by default on a third-party installation script or VM deployment image.

The collection of vulnerabilities is collectively named "<a href="https://imagetragick.com/" target="_blank">ImageTragick</a>," which is itself a new low in the recent plague of unnecessarily named security vulnerabilities.

The primary vulnerability, designed as <a href="https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2016-3714" target="_blank">CVE-2016-3714</a>, creates the potential for remote code execution, as ImageMagick fails to properly sanitize special characters from user input. In cases where a file is passed to ImageMagick—such as a PDF, Microsoft Office, or <a href="https://en.wikipedia.org/wiki/OpenDocument" target="_blank">OpenDocument</a> file—the file is handed to an external library with appropriate command line options for processing, called "delegates" in ImageMagick.

An <a href="http://www.openwall.com/lists/oss-security/2016/05/03/18" target="_blank">exploit</a> for this vulnerability is publicly available and experts say it has already been leveraged in the wild.

ImageMagick developers attempted to patch the vulnerability with the release of versions 6.9.3-9 and 7.0.1-0 on April 30, but researchers say the fix is incomplete. Another patch will be included in ImageMagick 7.0.1-1 and 6.9.3-10, which are expected to become available by this weekend.

In the meantime, users have been <a href="https://www.imagemagick.org/discourse-server/viewtopic.php?f=4&amp;t=29588" target="_blank">advised</a> to disable vulnerable coders by modifying their policy files. Another mitigation involves verifying that magic bytes correspond to image file types before sending the file to ImageMagick for processing.
<h2><strong>How to mitigate the vulnerability ?</strong></h2>
<em>source :<a href="https://imagetragick.com/"> https://imagetragick.com/</a></em>

If you use ImageMagick or an affected library, we recommend you mitigate the known vulnerabilities by doing at least one of these two things:
<ol>
 	<li>Verify that all image files begin with the expected <a href="https://en.wikipedia.org/wiki/List_of_file_signatures">"magic bytes"</a> corresponding to the image file types you support before sending them to ImageMagick for processing.</li>
 	<li>Use a <a href="https://www.imagemagick.org/script/resources.php">policy file</a> to disable the vulnerable ImageMagick coders. The global policy for ImageMagick is usually found in “/etc/ImageMagick”.</li>
</ol>
The below policy.xml example will disable the coders EPHEMERAL, URL, MVG, and MSL.
<div id="policy" class="panel panel-info">
<div class="panel-body">
<pre>&lt;policymap&gt;
  &lt;policy domain="coder" rights="none" pattern="EPHEMERAL" /&gt;
  &lt;policy domain="coder" rights="none" pattern="URL" /&gt;
  &lt;policy domain="coder" rights="none" pattern="HTTPS" /&gt;
  &lt;policy domain="coder" rights="none" pattern="MVG" /&gt;
  &lt;policy domain="coder" rights="none" pattern="MSL" /&gt;
  &lt;policy domain="coder" rights="none" pattern="TEXT" /&gt;
  &lt;policy domain="coder" rights="none" pattern="SHOW" /&gt;
  &lt;policy domain="coder" rights="none" pattern="WIN" /&gt;
  &lt;policy domain="coder" rights="none" pattern="PLT" /&gt;
&lt;/policymap&gt;
</pre>
</div>
</div>
&nbsp;
<pre></pre>